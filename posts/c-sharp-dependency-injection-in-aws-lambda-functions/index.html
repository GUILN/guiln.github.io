<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.a22026851d0737ff10d8.css" id="gatsby-global-css">html{font-size:100}body{margin:0 0 0 calc(100vw - 100%);color:#eee;background-color:#222;line-height:1.625;font-size:1rem;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}body,h1,h2,h3,h4,h5,h6{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif}h1,h2,h3,h4,h5,h6{font-weight:600}h1{font-size:2.5rem;line-height:3.25rem;margin-top:6.5rem;margin-bottom:1.625rem}h2{font-size:1.6875rem;line-height:2.4375rem}h2,h3{margin-top:3.25rem;margin-bottom:.8125rem}h3{font-size:1.375rem;line-height:1.625rem}h4{font-size:1.2rem;margin-top:2.4375rem}h4,h5{line-height:1.625rem;margin-bottom:.8125rem}h5,h6{font-size:1rem;margin-top:4.0625rem}h6{line-height:1.625rem;margin-bottom:.8125rem}img{max-width:100%;margin:inherit auto}hr,img{border:0;display:block}hr{color:#eee;height:1.625rem;margin:3.25rem auto;background-size:100% 26px;background-image:linear-gradient(180deg,transparent 1px,transparent 11px,#eee 0,#eee 15px,transparent 0,transparent 26px);width:6.25rem}a{color:#4ecca3;text-decoration:none}a:active,a:focus,a:hover{color:#393e46}b,strong{font-weight:600}ul{list-style:square;margin-bottom:1.625rem}ul li{padding:0 .3125rem;margin-bottom:.625rem}p{line-height:1.625rem;margin-bottom:1.625rem}blockquote{padding:0;font-style:italic;text-align:center}figure{display:block;width:100%;height:auto}figcaption{line-height:1.21875rem;margin-top:.40625rem;color:#eee;font-size:.875rem;font-style:italic;margin-bottom:0;text-align:center}.anchor{margin-left:-1.875rem!important;padding-right:.875rem!important}@media screen and (min-width:685px){figure.float-left,figure.float-right{max-width:19.375rem;padding:0 1.625rem}.float-right{float:right}.float-left{float:left}}code[class*=language-],pre[class*=language-]{color:#fff;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:.82em;text-align:left;text-shadow:0 -.1em .2em #000;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}:not(pre)>code[class*=language-],pre[class*=language-]{background:#141414}pre[class*=language-]{border-radius:.15em;border:.2em solid #545454;box-shadow:inset 1px 1px .5em #000;margin:.5em 0;overflow:auto;padding:1em}pre[class*=language-]::selection{background:#27292a}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:hsla(0,0%,93%,.15)}:not(pre)>code[class*=language-]{border-radius:.3em;border:.13em solid #545454;box-shadow:inset 1px 1px .3em -.1em #000;padding:.15em .2em .05em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#787878}.token.namespace,.token.punctuation{opacity:.7}.token.boolean,.token.deleted,.token.number,.token.tag{color:#cf694a}.token.builtin,.token.constant,.token.keyword,.token.property,.token.selector,.token.symbol{color:#f9ee9a}.language-css .token.string,.style .token.string,.token.attr-name,.token.attr-value,.token.char,.token.entity,.token.inserted,.token.operator,.token.string,.token.url,.token.variable{color:#919e6b}.token.atrule{color:#7386a5}.token.important,.token.regex{color:#e9c163}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}pre[data-line]{padding:1em 0 1em 3em;position:relative}.language-markup .token.attr-name,.language-markup .token.punctuation,.language-markup .token.tag{color:#ad895c}.token{position:relative;z-index:1}.line-highlight{background:rgba(84,84,84,.25);background:linear-gradient(90deg,rgba(84,84,84,.1) 70%,rgba(84,84,84,0));border-bottom:1px dashed #545454;border-top:1px dashed #545454;left:0;line-height:inherit;margin-top:.75em;padding:inherit 0;pointer-events:none;position:absolute;right:0;white-space:pre;z-index:0}.line-highlight:before,.line-highlight[data-end]:after{background-color:#8794a6;border-radius:999px;box-shadow:0 1px #fff;color:#f5f2f0;content:attr(data-start);font:700 65%/1.5 sans-serif;left:.6em;min-width:1em;padding:0 .5em;position:absolute;text-align:center;text-shadow:none;top:.4em;vertical-align:.3em}.line-highlight[data-end]:after{bottom:.4em;content:attr(data-end);top:auto}.Author-module--author__photo--36xCH{display:inline-block;margin-bottom:0;border-radius:50%;background-clip:padding-box}.Author-module--author__title--2CaTb{font-size:1.125rem;font-weight:600;line-height:1.82813rem;margin:.8125rem 0}.Author-module--author__title-link--Yrism,.Author-module--author__title-link--Yrism:focus,.Author-module--author__title-link--Yrism:hover{color:#eee}.Author-module--author__subtitle--cAaEB{color:#fff;line-height:1.625rem;margin-bottom:1.625rem}.Icon-module--icon--Gpyvw{display:inline-block;width:1em;height:1em;stroke-width:0;stroke:currentColor;fill:currentColor;font-style:normal;font-weight:400;speak:none;margin-right:.2em;text-align:center;font-variant:normal;text-transform:none;line-height:1em;margin-left:.2em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.Contacts-module--contacts--1rGd1{margin-bottom:1.625rem}.Contacts-module--contacts__list--3OgdW{display:flex;flex-flow:row wrap;flex-grow:0;flex-shrink:0;list-style:none;padding:0;margin:.625rem -.1875rem;width:8.75rem}.Contacts-module--contacts__list-item--16p9q{padding:0;margin:.25rem;display:flex;align-content:center;align-items:center;justify-content:center;height:2.1875rem;width:2.1875rem;line-height:2.1875rem;border-radius:50%;text-align:center;border:1px solid #fff}.Contacts-module--contacts__list-item-link--2MIDn{border:0;display:flex;color:#eee}.Contacts-module--contacts__list-item-link--2MIDn:focus,.Contacts-module--contacts__list-item-link--2MIDn:hover{color:#4ecca3}.Copyright-module--copyright--1ariN{color:#fff;font-size:.875rem}.Menu-module--menu--Efbin{margin-bottom:1.625rem}.Menu-module--menu__list--31Zeo{list-style:none;padding:0;margin:0}.Menu-module--menu__list-item--1lJ6B{padding:0;margin:.625rem 0}.Menu-module--menu__list-item-link--10Ush{font-size:1rem;color:#eee;font-weight:400;border:0}.Menu-module--menu__list-item-link--10Ush:focus,.Menu-module--menu__list-item-link--10Ush:hover{color:#4ecca3;border-bottom:1px solid #4ecca3}.Menu-module--menu__list-item-link--active--2CbUO{color:#eee;border-bottom:1px solid #eee}.Sidebar-module--sidebar--X4z2p{width:100%}.Sidebar-module--sidebar__inner--Jdc5s{position:relative;padding:1.5625rem 1.25rem 0}@media screen and (min-width:685px){.Sidebar-module--sidebar--X4z2p{width:calc(41.625% - 1.09375rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(12n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(12n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:1.875rem 1.25rem 0}.Sidebar-module--sidebar__inner--Jdc5s:after{background:#fff;background:linear-gradient(180deg,#fff 0,#fff 48%,#393e46);position:absolute;content:"";width:.0625rem;height:33.75rem;top:30px;right:-10px;bottom:0}}@media screen and (min-width:960px){.Sidebar-module--sidebar--X4z2p{width:calc(33.3% - 1.25rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(3n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(3n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:2.5rem}}.Layout-module--layout--3Pyz6{max-width:66.875rem;margin-left:auto;margin-right:auto}.Layout-module--layout--3Pyz6:before{content:"";display:table}.Layout-module--layout--3Pyz6:after{content:"";display:table;clear:both}.Feed-module--feed__item--2D5rE{margin-bottom:2.03125rem}.Feed-module--feed__item--2D5rE:last-child{margin-bottom:.8125rem}.Feed-module--feed__item-title--3nigr{font-size:1.6875rem;line-height:2.4375rem;margin-top:0;margin-bottom:.8125rem}.Feed-module--feed__item-title-link--iFMRs{color:#eee}.Feed-module--feed__item-title-link--iFMRs:focus,.Feed-module--feed__item-title-link--iFMRs:hover{color:#eee;border-bottom:1px solid #eee}.Feed-module--feed__item-description--1uO8e{font-size:1rem;line-height:1.625rem;margin-bottom:1.21875rem}.Feed-module--feed__item-meta-time--3t1fg{font-size:.875rem;color:#eee;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-divider--N-Q0A{margin:0 .3125rem}.Feed-module--feed__item-meta-category-link--23f8F{font-size:.875rem;color:#393e46;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-category-link--23f8F:focus,.Feed-module--feed__item-meta-category-link--23f8F:hover{color:#4ecca3}.Feed-module--feed__item-readmore--1u6bI{font-size:1rem;color:#4ecca3}.Feed-module--feed__item-readmore--1u6bI:focus,.Feed-module--feed__item-readmore--1u6bI:hover{color:#4ecca3;border-bottom:1px solid #4ecca3}.Page-module--page--2nMky{margin-bottom:3.25rem}.Page-module--page__inner--2M_vz{padding:1.5625rem 1.25rem}.Page-module--page__title--GPD8L{font-size:2.5rem;font-weight:600;line-height:3.25rem;margin-top:0;margin-bottom:2.35625rem}.Page-module--page__body--Ic6i6{font-size:1rem;line-height:1.625rem;margin:0 0 1.625rem}@media screen and (min-width:685px){.Page-module--page--2nMky{width:calc(58.275% - .78125rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(12n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(12n+1){clear:both}.Page-module--page__inner--2M_vz{padding:1.875rem 1.25rem}}@media screen and (min-width:960px){.Page-module--page--2nMky{width:calc(66.6% - .625rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(3n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(3n+1){clear:both}.Page-module--page__inner--2M_vz{padding:2.5rem 2.1875rem}}.Pagination-module--pagination--2H3nO{margin-top:3.25rem;display:flex}.Pagination-module--pagination__prev--bet5s{width:50%;text-align:left}.Pagination-module--pagination__prev-link--1Nzs6{color:#393e46;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__prev-link--1Nzs6:focus,.Pagination-module--pagination__prev-link--1Nzs6:hover{color:#4ecca3}.Pagination-module--pagination__prev-link--disable--Yklx9{pointer-events:none;color:#fff}.Pagination-module--pagination__next--3hFiN{width:50%;text-align:right}.Pagination-module--pagination__next-link--3FUtA{color:#393e46;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__next-link--3FUtA:focus,.Pagination-module--pagination__next-link--3FUtA:hover{color:#4ecca3}.Pagination-module--pagination__next-link--disable--30UwZ{pointer-events:none;color:#fff}.Author-module--author--2Yefr{border-top:1px solid #fff;max-width:40rem;padding-top:1.25rem;line-height:1.625rem;margin-top:1.625rem;margin-bottom:3.25rem}.Author-module--author__bio-twitter--n-O9n{display:block;text-decoration:underline}@media screen and (min-width:685px){.Author-module--author--2Yefr{margin-left:auto;margin-right:auto}}.Content-module--content--3p512{max-width:59.0625rem;padding:0 .9375rem;margin:0 auto}.Content-module--content__title--2BDW9{font-size:2rem;max-width:40rem;font-weight:600;text-align:center;line-height:2.68125rem;margin:1.625rem auto 0}.Content-module--content__body--2TrQ- figure{margin-bottom:1.625rem}.Content-module--content__body--2TrQ- figure blockquote{font-style:italic;text-align:center;margin-top:0;padding:1.625rem 0}.Content-module--content__body--2TrQ- figure blockquote p{max-width:40rem;font-size:1.6817rem;margin-top:0;margin-bottom:1.625rem;line-height:2.4375rem}.Content-module--content__body--2TrQ- a{text-decoration:underline}.Content-module--content__body--2TrQ- *{max-width:40rem;margin-left:auto;margin-right:auto}.Content-module--content__body--2TrQ- img{max-width:100%}@media screen and (min-width:960px){.Content-module--content--3p512{padding:0}.Content-module--content__title--2BDW9{font-size:3rem;line-height:3.65625rem;margin-top:3.65625rem;margin-bottom:2.4375rem}.Content-module--content__body--2TrQ-,.Content-module--content__body--2TrQ- p{font-size:1.125rem;line-height:1.82813rem;margin-bottom:1.82813rem}}.Meta-module--meta__date--29eD7{font-style:italic}.Tags-module--tags--1L_ct{margin-bottom:.8125rem}.Tags-module--tags__list--91FqN{list-style:none;margin:0 -.625rem;padding:0}.Tags-module--tags__list-item--1M30P{display:inline-block;margin:.625rem .3125rem}.Tags-module--tags__list-item-link--3SL_8{display:inline-block;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;border:1px solid #fff;text-decoration:none;border-radius:1.25rem;color:#eee}.Tags-module--tags__list-item-link--3SL_8:focus,.Tags-module--tags__list-item-link--3SL_8:hover{color:#4ecca3}.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{max-width:40rem;margin:0 auto;padding:0 .9375rem}.Post-module--post__home-button--16Kl0{display:block;max-width:5.625rem;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;text-align:center;color:#eee;border:1px solid #fff;border-radius:1.25rem;font-size:1rem;font-weight:400;margin-left:auto;margin-right:auto;margin-top:1.625rem}.Post-module--post__home-button--16Kl0:focus,.Post-module--post__home-button--16Kl0:hover{color:#4ecca3}@media screen and (min-width:960px){.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{padding:0}.Post-module--post__home-button--16Kl0{position:fixed;max-width:auto;margin:0;top:30px;left:30px}}</style><meta name="generator" content="Gatsby 2.32.13"/><link rel="alternate" type="application/rss+xml" title="Blog Guiln" href="/rss.xml"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-73379983-2"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){window.dataLayer && window.dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-73379983-2', {"send_page_view":false});
      }
      </script><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="icon" href="/favicon-32x32.png?v=75365486ad616e3a01ab6e401c2389df" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#F7A046"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=75365486ad616e3a01ab6e401c2389df"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=75365486ad616e3a01ab6e401c2389df"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=75365486ad616e3a01ab6e401c2389df"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=75365486ad616e3a01ab6e401c2389df"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=75365486ad616e3a01ab6e401c2389df"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=75365486ad616e3a01ab6e401c2389df"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=75365486ad616e3a01ab6e401c2389df"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=75365486ad616e3a01ab6e401c2389df"/><title data-react-helmet="true">C# Dependency Injection in AWS Lambda Functions - Blog Guiln</title><meta data-react-helmet="true" name="description" content="An approach on how to work with dotnet core DI in AWS Lambda environment."/><meta data-react-helmet="true" property="og:site_name" content="C# Dependency Injection in AWS Lambda Functions - Blog Guiln"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:title" content="C# Dependency Injection in AWS Lambda Functions - Blog Guiln"/><meta data-react-helmet="true" name="twitter:description" content="An approach on how to work with dotnet core DI in AWS Lambda environment."/><link as="script" rel="preload" href="/webpack-runtime-9724be7cdbeeb1195ef5.js"/><link as="script" rel="preload" href="/framework-1e331b2e9d55ebef6dec.js"/><link as="script" rel="preload" href="/532a2f07-549094fa347c85980056.js"/><link as="script" rel="preload" href="/dc6a8720040df98778fe970bf6c000a41750d3ae-76dc177fd16284b137ef.js"/><link as="script" rel="preload" href="/app-b0ec7eb7d4259b5a0db0.js"/><link as="script" rel="preload" href="/styles-407fe62976dc5310c43e.js"/><link as="script" rel="preload" href="/cd95ea5cbd2c605f26db819f07999610c9ff4310-7878269c7be0134bc3ef.js"/><link as="script" rel="preload" href="/component---src-templates-post-template-js-ee609417a04c8df55a29.js"/><link as="fetch" rel="preload" href="/page-data/posts/c-sharp-dependency-injection-in-aws-lambda-functions/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/251939775.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3439816877.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/401334301.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="Layout-module--layout--3Pyz6"><div><a class="Post-module--post__home-button--16Kl0" href="/">All Articles</a><div><div class="Content-module--content--3p512"><h1 class="Content-module--content__title--2BDW9">C# Dependency Injection in AWS Lambda Functions</h1><div class="Content-module--content__body--2TrQ-"><ul>
<li><a href="#context">Context</a></li>
<li><a href="#dependency-inversion-principle">Dependency Inversion Principle</a></li>
<li><a href="#writing-some-code">Writing Some Code</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
<p>An Intro about Dependency injection in Lambda environment</p>
<h2 id="context" style="position:relative;"><a href="#context" aria-label="context permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Context</h2>
<p>When working with .Net core AWS lambda functions, we do not have some fancy hooks that ables us to wire the dependencies in runtime.
This situation leaves us by ourselves to add the necessary code that overcomes this situation.</p>
<h2 id="dependency-inversion-principle" style="position:relative;"><a href="#dependency-inversion-principle" aria-label="dependency inversion principle permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Dependency Inversion Principle</h2>
<p>Despite the fact we won’t have option to use dotnet core’s <code class="language-text">IoC Container</code> in it entire functionality, is not complicated to keep the dependency inversion or injection principle, at the end of the day the most important to keep from this principle is to make sure that we can inject the dependencies and keep our lambda as flexible through different environments and as testable as it would be when working in a “pure” dotnet core environment.
So, with that in mind we will go through a simple, yet efficient approach. Which reminds me the words of <em>Gary McLean Hall</em> in book <em>Adaptive Code Via C#: Agile coding with design patterns and SOLID principles</em>: </p>
<blockquote>
<p>When something is so simple, yet so important, people tend to overcomplicate it. DI is no exception…</p>
<p>— Gary McLean Hall</p>
</blockquote>
<p>So, I’ll present in next few lines the most fancy <code class="language-text">Poor Man&#39;s</code> DI that I’ve ever written. Let’s write, and discuss some code focusing in:</p>
<ul>
<li>Keeping the DI (Most important)</li>
<li>Avoiding DI anti patterns (<code class="language-text">Service Locator</code>)</li>
<li>Making it configurable through environments</li>
<li>Making it testable!</li>
<li>Keeping it simple</li>
</ul>
<h2 id="writing-some-code" style="position:relative;"><a href="#writing-some-code" aria-label="writing some code permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Writing Some Code</h2>
<p>Let’s start with <code class="language-text">IConfigurationService</code> interface. This interface will be used as a high level container for the overall configuration dependencies.</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IConfigurationService</span>
<span class="token punctuation">{</span>
     <span class="token return-type class-name">IConfiguration</span> <span class="token function">GetConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>So <code class="language-text">IConfigurationService</code> will be implemented for each environment, in our case we will only have <code class="language-text">Dev</code> and <code class="language-text">local</code>:</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token comment">//Dev</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DevConfigurationService</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IConfigurationService</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">IConfiguration</span> <span class="token function">GetConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ConfigurationBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">AddSystemsManager</span><span class="token punctuation">(</span><span class="token string">"/application-config/order-info-config/"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//Local</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LocalConfigurationService</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IConfigurationService</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">IConfiguration</span> <span class="token function">GetConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ConfigurationBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">AddJsonFile</span><span class="token punctuation">(</span><span class="token string">"settings.json"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p><code class="language-text">IEnvironmentServiceConfiguration</code> will be the interface to be implemented for every environment to wire all services. If we wish to add some different <code class="language-text">ILogger</code> implementation, for example, this is where we should go. Note that I opted to make the environment selection through a static <code class="language-text">Factory Method</code> in the interface:</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IEnvironmentServiceConfiguration</span>
<span class="token punctuation">{</span>
   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">IEnvironmentServiceConfiguration</span> <span class="token function">CreateServiceConfiguration</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> environmentName<span class="token punctuation">)</span>
   <span class="token punctuation">{</span>
           <span class="token keyword">return</span> environmentName <span class="token keyword">switch</span>
           <span class="token punctuation">{</span>
               <span class="token string">"dev"</span> <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DevServiceConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
               <span class="token string">"local"</span> <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">LocalServiceConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
               _ <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">LocalServiceConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
           <span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
       
   <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> serviceCollection<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Following, the implementation of the interface above for both <code class="language-text">Dev</code> and <code class="language-text">Local</code> environments.</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token comment">//Dev</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DevServiceConfiguration</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IEnvironmentServiceConfiguration</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> serviceCollection<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        serviceCollection<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSingleton</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IConfigurationService<span class="token punctuation">,</span> DevConfigurationService<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//Local</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LocalServiceConfiguration</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IEnvironmentServiceConfiguration</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> serviceCollection<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        serviceCollection<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSingleton</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IConfigurationService<span class="token punctuation">,</span> LocalConfigurationService<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>To glue all the DI logic and make it automatically change for each environment, we add a singleton class <code class="language-text">Bootstrapper</code> to wire the environment instantiation logic. Note that in that case we are assuming that expected <code class="language-text">&quot;local&quot;</code> and <code class="language-text">&quot;dev&quot;</code> values will come from <code class="language-text">ENVIRONMENT</code> environment variable. This will allow us to configure different <code class="language-text">ServiceCollections</code> among the different environments. We are also using previously declared factory method to instantiate the implementation of <code class="language-text">IEnvironmentServiceConfiguration</code>, which will be used to configure our service collection.</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Bootstrapper</span>
<span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">IServiceProvider</span> ServiceProvider <span class="token operator">=></span> _serviceCollection<span class="token punctuation">.</span><span class="token function">BuildServiceProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">IServiceCollection</span> _serviceCollection<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Bootstrapper</span> _instance<span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token function">Bootstrapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            _serviceCollection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ServiceCollection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">var</span></span> environment <span class="token operator">=</span> Environment<span class="token punctuation">.</span><span class="token function">GetEnvironmentVariable</span><span class="token punctuation">(</span><span class="token string">"ENVIRONMENT"</span><span class="token punctuation">)</span> <span class="token operator">??</span>
                              <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ApplicationException</span><span class="token punctuation">(</span><span class="token string">"'ENVIRONMENT' must be set"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">var</span></span> environmentServiceConfiguration <span class="token operator">=</span>
                IEnvironmentServiceConfiguration<span class="token punctuation">.</span><span class="token function">CreateServiceConfiguration</span><span class="token punctuation">(</span>environment<span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            environmentServiceConfiguration<span class="token punctuation">.</span><span class="token function">ConfigureServices</span><span class="token punctuation">(</span>_serviceCollection<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">Bootstrapper</span> <span class="token function">GetInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>_instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                _instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Bootstrapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> _instance<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>At this point is important to say that, you and your team could easily fall in the temptation of practicing the <code class="language-text">Service Locator</code> anti pattern, this assumption is specially true when using an “home made” IoC container “resolver” because it simply does not feels weird to use your own piece of code to resolve dependencies at any part of your project as it does when dealing with third party IoC container.<br>
If you fall in this temptation your project will quickly be with “magic” dependencies that will get hard to debug, and hard to tell what does a method / class needs to work just by looking at it usage. So keep the DI spirit downstream your classes / methods!
A good metric that I use to avoid this anti pattern is:</p>
<blockquote>
<p>Whenever I see the usage of a method / class, I should be able to tell all the dependencies by simply looking at method / object’s constructor parameters. If I’m not able to do that, some magic stuff is going inside that class. You now have “skyhooks” instead of cranes in your code base.</p>
<p>— Just me quoting myself</p>
</blockquote>
<p>The usage in code should be simple, as we assume that DI should always be done in the entry point of our program, the entry point for a lambda function will be the constructor of the <code class="language-text">Function</code> class.</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Function</span>
<span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">IConfiguration</span> _configurationService<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token function">Function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
          <span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">(</span>Bootstrapper<span class="token punctuation">.</span><span class="token function">GetInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span>ServiceProvider
                            <span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetService</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IConfigurationService<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">GetConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token function">Function</span><span class="token punctuation">(</span><span class="token class-name">IConfiguration</span> configurationService<span class="token punctuation">)</span> <span class="token operator">=></span> 
                      <span class="token punctuation">(</span>_configurationService<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span>configurationService<span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>APIGatewayProxyResponse<span class="token punctuation">></span></span> <span class="token function">FunctionHandler</span><span class="token punctuation">(</span><span class="token class-name">APIGatewayProxyRequest</span> apigProxyEvent<span class="token punctuation">,</span>
            <span class="token class-name">ILambdaContext</span> context<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Configured value: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">_configurationService<span class="token punctuation">[</span><span class="token string">"configured-variable-per-environment"</span><span class="token punctuation">]</span></span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token range operator">..</span><span class="token range operator">..</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>The idea of having two constructors for the lambda is that the parameterless one will be called by lambda mechanism itself when you, for example, call <code class="language-text">sam local invoke</code> locally, or when you run your lambda in your <code class="language-text">AWS</code> environment. The constructor that receives <code class="language-text">IConfiguration</code> parameter will be used for testing purposes, so we can easily mock <code class="language-text">IConfigurationService</code> dependency for automated tests. </p>
<h2 id="conclusion" style="position:relative;"><a href="#conclusion" aria-label="conclusion permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Conclusion</h2>
<p>This approach keeps DI in lambda with the simplicity of using the <code class="language-text">IServiceProvider</code> and <code class="language-text">IServiceCollection</code> from <a href="https://www.nuget.org/packages/Microsoft.Extensions.DependencyInjection/" target="_blank" rel="nofollow noopener noreferrer">Microsoft.Extensions.DependencyInjection</a> package to register our dependencies. It also overcomes the lack of a mechanism to wire dependencies between different environments that lambda environments leaves us with.</p></div></div></div><div class="Post-module--post__footer--3WzWU"><div><p class="Meta-module--meta__date--29eD7">Published <!-- -->Jun 2, 2021</p></div><div class="Tags-module--tags--1L_ct"><ul class="Tags-module--tags__list--91FqN"><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/aws/">AWS</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/lambda/">Lambda</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/serverless/">Serverless</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/c/">C#</a></li></ul></div><div class="Author-module--author--2Yefr"><p>Software Developer.<a class="Author-module--author__bio-twitter--n-O9n" href="https://www.twitter.com/undefined" rel="noopener noreferrer" target="_blank"></a></p></div></div><div class="Post-module--post__comments--25y6I"></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/posts/c-sharp-dependency-injection-in-aws-lambda-functions";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-8de6de3a6555a9e76093.js"],"app":["/app-b0ec7eb7d4259b5a0db0.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-fd4fb51a6fac1c18bdde.js"],"component---src-templates-categories-list-template-js":["/component---src-templates-categories-list-template-js-2181ec47d28e5c35d3e9.js"],"component---src-templates-category-template-js":["/component---src-templates-category-template-js-6a4ccb9f4a6261541e29.js"],"component---src-templates-index-template-js":["/component---src-templates-index-template-js-fdd8536acd3c57081720.js"],"component---src-templates-not-found-template-js":["/component---src-templates-not-found-template-js-658f4507169e2836a377.js"],"component---src-templates-page-template-js":["/component---src-templates-page-template-js-d8aeb4e67f2e8af3e6cd.js"],"component---src-templates-post-template-js":["/component---src-templates-post-template-js-ee609417a04c8df55a29.js"],"component---src-templates-tag-template-js":["/component---src-templates-tag-template-js-6f77d5f667fd901ff51f.js"],"component---src-templates-tags-list-template-js":["/component---src-templates-tags-list-template-js-2d7007993fc2bf0f9caf.js"]};/*]]>*/</script><script src="/polyfill-8de6de3a6555a9e76093.js" nomodule=""></script><script src="/component---src-templates-post-template-js-ee609417a04c8df55a29.js" async=""></script><script src="/cd95ea5cbd2c605f26db819f07999610c9ff4310-7878269c7be0134bc3ef.js" async=""></script><script src="/styles-407fe62976dc5310c43e.js" async=""></script><script src="/app-b0ec7eb7d4259b5a0db0.js" async=""></script><script src="/dc6a8720040df98778fe970bf6c000a41750d3ae-76dc177fd16284b137ef.js" async=""></script><script src="/532a2f07-549094fa347c85980056.js" async=""></script><script src="/framework-1e331b2e9d55ebef6dec.js" async=""></script><script src="/webpack-runtime-9724be7cdbeeb1195ef5.js" async=""></script></body></html>